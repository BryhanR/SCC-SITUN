<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Ingresar Usuario</title>
        


	<script src="\..\javascripts\new\jquery-1.12.2.js"></script>
<script src="\..\javascripts\new\moment-2.15.1.js"></script>

<script src="\..\javascripts\new\bootstrap-3-3-7.min.js"></script>

<link rel="stylesheet" href="\..\javascripts\new\bootstrap-3-3-7.min.css">


<script src="\..\javascripts\new\bootstrap-datetimepicker-4.7.14.js"></script>

<link rel="stylesheet" href="\..\javascripts\new\bootstrap-datetimepicker-4.7.14.css">
    <!-- Angular--> 
	
	
   </head>
   
    <body>  
	<div id="menuDiv"></div>
	
  	<!-- Trigger the modal with a button -->
<!-- Modal -->
	  
<div id="myAyuda" class="modal fade" role="dialog" style="margin: 0 auto; width:675px; height:325px;">
  <div class="modal-dialog">
   
    <!-- Modal content-->
   <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="text-danger">Ayuda</h4>
      </div>
      <div class="modal-body">
		<center>
                <tbody>
					Para ingresar un usuario se debe llenar todos los campos requeridos
					en la página correctamente, en caso de que el usuario que se va a
					ingresar es un administrador en el sistema, se deberá seleccionar la 
					opción Administrador y presionar el botón Guardar. Sino es un administrador 
					no se debe de seleccionar esa opción.				
				</tbody> 
	       </center>
		
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button></center>	
      </div>
    </div>

  </div>
  </div>  <!-- fin del popup de ayuda --> 

	   <!---Cuerpo-->
	   <a href='#' onclick='MIU_14();return false' title='Ir Arriba'></a><!--Para subir la pagina-->
	   <body background="../images/situn4.png" >
	     <div class="col-md-1"></div>
	   <div class="col-md-4">
         <span class="text-danger"><h3>Ingresar Usuario</h3></span><br>
            <form name = "Formulario">
            <table id ="tablaIU">
                <tbody>
					<tr></tr>
				<tr>
                    <td><label class="text-danger">Nombre</label></td>
					<td><div id="div1" class="form-group"><textarea id="IU1" type="text" class="form-control"  onfocus="limpiaCamposEnfocados(1)"></textarea></div></td>
				</tr>
                <tr>
                    <td> <label class="text-danger">Apellido 1</label> </td>
                   <td><div id="div2" class="form-group"><textarea id="IU2" type="text" class="form-control"  onfocus="limpiaCamposEnfocados(2)"></textarea></div></td> 
				</tr>
				  <tr>
                    <td> <label class="text-danger">Apellido 2</label> </td>
                   <td><div id="div3" class="form-group"><textarea id="IU3" type="text" class="form-control"  onfocus="limpiaCamposEnfocados(3)"></textarea></div></td> 
				</tr>
                <tr>
                    <td> <label class="text-danger">Identificación</label> </td>
                   <td><div id="div4" class="form-group"><textarea id="IU4" type="text" class="form-control"  onfocus="limpiaCamposEnfocados(4)"></textarea></div></td> 
                </tr>
                <tr>
                    <td> <label class="text-danger">Contraseña </label></td>
                    <td><div id="div5" class="form-group"><input id="IU5" type="password" class="form-control"  onfocus="limpiaCamposEnfocados(5)"></textarea></div></td> 
                </tr>
				 <tr>
                    <td> <label class="text-danger">Confirmar contraseña  </label></td>
                    <td><div id="div6" class="form-group" ><input id="IU6" type="password" class="form-control"  onfocus="limpiaCamposEnfocados(6)"></textarea></div></td> 
                </tr>
					<tr>
                    <td> <label class="text-danger">Administrador </label></td>
					<td><div id="div7" class="form-group" style="margin-left:10px;"> <input  type="checkbox" id="IU7" value="enlace_checkbox" ></div></td>
                </tr>


                <tr>
                    <td ><center><button type="button" class="btn btn-default"  onclick ="botonGuardar()">Guardar</button></center>
					</td>
                    <td ><center><button type="button" class="btn btn-default" onclick="botonCancelar()">Cancelar</button></td></center>
                </tr>
					</center>		
				</tbody>
			 
			</table>  
		</form>  
		<label  id="mensaje" class="text-danger">
			   </div>
		
		
			<div class="col-md-3"></div>
			<div class="col-md-3"> 		
					<center><div class="date panel-danger" style="background-color:#60161E; color:white; margin-top:240px" ></center><!-- div calendario-->
			 
					<script src="\..\javascripts/bootstrap-datepicker.js"></script> <!---Si se borra el pierde trate de acomodarlo 
		        en donde estan los otros js pero dice que no se encuentran, como que este y el bootstrap-datepicker.min.js chocan-->	
				</div>
			  
		     </div>
		

	    
<script type="text/javascript">
  
  $(document).ready(function () { //Metodo del calendario

  		$("#menuDiv").load("/HTML/menu");
                
                $('.date').datepicker({         
            });
			$('#ayuda').click(
		function(){
			$('#miAyuda').show();
			});
     });
 
						
 function existeUsuario(){//Realiza la consulta si un usuario existe
 
	let d = $('#IU4').val().toUpperCase();
	 fetch( 'http://localhost:3000/api/TP/B', {  
    method: 'POST', 
    datatype:'json',
    headers: {  
      "Content-type": "application/x-www-form-urlencoded"  
      } ,
    body: "TP_4="+ d
      }
	)	 .then(res => res.json())
     	
		.then(obj =>{
		if(obj.data[0]==null){
		setTimeout('botonCancelar()', 2000);
		ingresaInformacion();
		}
		else	
		$("#mensaje").text("Fallo al realizar la acción,\n el usuario a ingresar ya existe"); 
		
		}) 

		.catch(err => console.log('Request failed', err));
		
	

 }
		

	function botonGuardar(){//Realiza la función del boton de guardar llamando a los metodos correspondientes
	 if(validaCampos())
	existeUsuario();	
	
	
	}
	
function ingresaInformacion($scope){ //Recoge los datos de los campos y realiza el fecth de inserción 
							//a la base de datos
							
	let e3 = $('#IU1').val().toUpperCase();
	let f3 = $('#IU2').val().toUpperCase();
	let g3 = $('#IU3').val().toUpperCase();
	let h3 = $('#IU4').val().toUpperCase();
	let o3 = $('#IU5').val().toUpperCase();
	//let i3 = $('#IU6').val().toUpperCase();
	let j3;
	if($("#IU7").prop("checked"))
	 j3 = '1'; 
	else
	j3='0';
	ingresaPersona(e3,f3,g3,h3);
	ingresaUsuario(h3,o3,j3);
	$("#mensaje").text("Acción realiza con exito");
 
}


function ingresaPersona(a,b,c,d){// Realiza la inserción de una persona a la base de datos

 fetch( 'http://localhost:3000/api/TP/I', {  
    method: 'POST', 
    datatype:'json',
    headers: {  
      "Content-type": "application/x-www-form-urlencoded"  
      } ,
    body: "TP_1="+ a + "&TP_2="+ b +"&TP_3="+ c +"&TP_4="+ d
      }
	  )
  .then(function(response) {
  return response.text().then(function(res) {
    console.log("Resultado: "+res);
    
  });
})
  .catch(function(error) {  
   console.log('Request failed', error);  
  });

	}
	
	function ingresaUsuario(a2,b2,c2){//Realiza la inserciónde un usuario a la base de datos

	fetch( 'http://localhost:3000/api/TU/I', {  
    method: 'POST', 
    datatype:'json',
    headers: {  
      "Content-type": "application/x-www-form-urlencoded"  
      } ,
    body: "TU_1="+ a2 + "&TU_2="+ b2 +"&TU_3="+ c2
      }
	  )
  .then(function(response) {
  return response.text().then(function(res) {
    console.log("Resultado: "+res);
    
  });
})
  .catch(function(error) {  
   console.log('Request failed', error);  
  });

	}

   
<!--valida todos los campos--->
function validaCampos(){	 //Valida los campos 
	I1 = true;
	I2 = true;
	I3 = true;
	I4 = true;
	I5 = true;
	I6= true;
	I7= true;

	if($("#IU1").val().length == 0 ){
		cambioClase2(1);		
		I1 = false;
	}
	else{
	cambioClase1(1);
	}
		
	if($("#IU2").val().length == 0){
		cambioClase2(2);		
		I2 = false;
	}
	else{
		cambioClase1(2);
	}
	if($("#IU3").val().length == 0){
		cambioClase2(3);		
		I3 = false;
	}
	else{
		cambioClase1(3);
	}
	if($("#IU4").val().length == 0){
		cambioClase2(4);		
		I4 = false;
	}
	else{
		cambioClase1(4);
	}
	
	if(isNaN($("#IU4").val())){
		$("#div4").attr('class','form-group has-error') ;
		$("#IU4").attr('title','Formato incorrecto') ;
		I7 = false;
	}
	else{
	if(I7&&I4){
		cambioClase1(4);
		}
	}
	if($("#IU5").val().length == 0){
		cambioClase2(5);		
		I5 = false;
	}
	else{
		cambioClase1(5);
	}
	
	if($("#IU6").val().length == 0){
		cambioClase2(6);		
		I6 = false;
	}
	else{
		cambioClase1(6);
	}
	if($("#IU6").val()!=$("#IU5").val()){
	$("#div6").attr('class','form-group has-error') ;
		$("#IU6").attr('title','La contraseña no coincide') ;
		$("#div5").attr('class','form-group has-error') ;
		$("#IU5").attr('title','La contraseña no coincide') ;
		$("#IU5").val("");
		$("#IU6").val("");
		I6 = false;
	}
	else{
	if(I6&&I5){
		cambioClase1(6);
		cambioClase1(5);
	}
	
		return (I1 && I2  && I3  && I4 && I5 && I6 &&I7);	
}}

function limpiaCampos(){//Limpia el valor de los campos de entrada
for(let i=1;i<7;i++){
	cambioClase1(i);
}
	$("#IU1").val("");
	$("#IU2").val("");
	$("#IU3").val("");
	$("#IU4").val("");
	$("#IU5").val("");
	$("#IU6").val("");
}

function cambioClase1(op){//Realiza un cambio de clase a los campos de entrada del formulario de la clase has-error a from-group
	switch(op){
	case 1: $("#div1").attr('class','form-group') ;
			$("#IU1").attr('title','');
			break;
	
	case 2: $("#div2").attr('class','form-group') ;
			$("#IU2").attr('title','');
			break;
	case 3: $("#div3").attr('class','form-group') ;
			$("#IU3").attr('title','');
			break;
	case 4: $("#div4").attr('class','form-group') ;
			$("#IU4").attr('title','');
			break;
	case 5: $("#div5").attr('class','form-group') ;
			$("#IU5").attr('title','');
			break;
	case 6: $("#div6").attr('class','form-group') ;
			$("#IU6").attr('title','');
			break;
	
	default: break;
	}
}	
	
function botonCancelar(){//Metodo del boton cancelar 
limpiaCampos();
limpiaDivMensaje();
}

function limpiaDivMensaje(){//Limpia el div con el id=mensaje 
$("#mensaje").text("");
}
 
function limpiaCamposEnfocados(n){//Limpia los campos cuando se enfocan 
  limpiaDivMensaje();
  cambioClase1(n);
 }
 	  
	  

function cambioClase2(op){//Realiza un cambio de clase a los campos de entrada del formulario de la clase from-group a has-error
	switch(op){
	case 1: $("#div1").attr('class','form-group has-error') ;
			$("#IU1").attr('title','Campo Obligatorio');
			break;
	
	case 2: $("#div2").attr('class','form-group has-error') ;
			$("#IU2").attr('title','Campo Obligatorio');
			break;
	case 3: $("#div3").attr('class','form-group has-error') ;
			$("#IU3").attr('title','Campo Obligatorio');
			break;
	case 4: $("#div4").attr('class','form-group has-error') ;
			$("#IU4").attr('title','Campo Obligatorio');
			break;
	case 5: $("#div5").attr('class','form-group has-error') ;
			$("#IU5").attr('title','Campo Obligatorio');
			break;
	case 6: $("#div6").attr('class','form-group has-error') ;
			$("#IU6").attr('title','Campo Obligatorio');
			break;
	
	default: break;
	}
}
  
</script>
    </body>
</html>