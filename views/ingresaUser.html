<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Ingresar Usuario</title>
        
	
  <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-combined.min.css" rel="stylesheet">
   
  <link rel="stylesheet" href="\..\stylesheets\bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
  <script src="\..\javascripts\bootstrap.min.js"></script>
  <link href="\..\stylesheets\bootstrap-datetimepicker.min.css" rel="stylesheet">
  <script type="text/javascript"src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script> 
    <script type="text/javascript"src="\..\javascripts\bootstrap-datetimepicker.min.js"></script>
	
	 <link rel="stylesheet" href="\..\stylesheets\datepicker.css">
        <link rel="stylesheet" href="\..\stylesheets\bootstrap.css">   
	
    <!-- Angular--> 
	<!--script src="\node_modules\bootstrap\dist\js\angular.min.js"></script-->
	
   </head>
   
    <body>  
	<div id="menuDiv"></div>
	<!--
	<nav class="navbar navbar-default" style="background-color:#60161E; ">
    <div class="container-fluid">
    <!-- ReEsponsive ->
    <div class="navbar-header" >
		<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>

   <IMG SRC="../images/situn2.png" WIDTH=90 HEIGHT=90  class="nav navbar-nav navbar-right">
    </div>
	
    <!-- Menu ->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
       <ul class="nav navbar-nav" style="margin-top:7px;">
      	<!--li><a href=""style="color:#FFFFFF;">SCC-SITUN</a></li->
         <li ><a href="../HTML/Ingreso de Correspondencia"style="color:#FFFFFF;">Ingreso Correspondencia</span> </a></li>
        <li><a href="../HTML/Enlace de Documentos"style="color:#FFFFFF;">Enlace Documentos</a></li>
        <li><a href="../HTML/Busqueda"style="color:#FFFFFF;">Búsqueda</a></li>	
		<li><a href="#"style="color:#FFFFFF;">Reportes</a></li>
		<!--li><a href="#"style="color:#FFFFFF;">Escanear</a></li->
		<li><a href="../HTML/ingresaUser"style="color:#FFFFFF;">Agregar Usuario</a></li>
		<li><a href="../HTML/BusquedaUsuarios"style="color:#FFFFFF;">Buscar Usuarios</a></li>
	    <li><a href="../logout"style="color:#FFFFFF;">Cerrar sesion</a></li>
		<li><a href="#" style="color:#FFFFFF;">Ayuda</a></li>
      </ul>
    
        <IMG SRC="../images/situn2.png" WIDTH=90 HEIGHT=90  class="nav navbar-nav navbar-right">
		
    </div><!-- /.navbar-collapse ->
  </div><!-- /.container-fluid ->
</nav>
	  -->
	   <!---Cuerpo-->
	   <a href='#' onclick='MIU_14();return false' title='Ir Arriba'></a><!--Para subir la pagina-->
	   <body background="../images/situn4.png" >
	     <div class="col-md-1"></div>
	   <div class="col-md-4">
         <span class="text-danger"><h3>Ingresar Usuario</h3></span><br><br>
            <form name = "Formulario">
            <table id ="tablaIU">
                <tbody>
					<tr></tr>
				<tr>
                    <td><label class="text-danger">Nombre</label></td>
					<td><div id="div1" class="form-group"><textarea id="IU1" type="text" class="form-control"  onfocus="MIU_07(1)"></textarea></div></td>
				</tr>
                <tr>
                    <td> <label class="text-danger">Apellido 1</label> </td>
                   <td><div id="div2" class="form-group"><textarea id="IU2" type="text" class="form-control"  onfocus="MIU_07(2)"></textarea></div></td> 
				</tr>
				  <tr>
                    <td> <label class="text-danger">Apellido 2</label> </td>
                   <td><div id="div3" class="form-group"><textarea id="IU3" type="text" class="form-control"  onfocus="MIU_07(3)"></textarea></div></td> 
				</tr>
                <tr>
                    <td> <label class="text-danger">Identificación</label> </td>
                   <td><div id="div4" class="form-group"><textarea id="IU4" type="text" class="form-control"  onfocus="MIU_07(4)"></textarea></div></td> 
                </tr>
                <tr>
                    <td> <label class="text-danger">Contraseña </label></td>
                    <td><div id="div5" class="form-group"><input id="IU5" type="password" class="form-control"  onfocus="MIU_07(5)"></textarea></div></td> 
                </tr>
				 <tr>
                    <td> <label class="text-danger">Confirmar contraseña  </label></td>
                    <td><div id="div6" class="form-group" ><input id="IU6" type="password" class="form-control"  onfocus="MIU_07(6)"></textarea></div></td> 
                </tr>
					<tr>
                    <td> <label class="text-danger">Administrador </label></td>
					<td><div id="div7" class="form-group" style="margin-left:10px;"> <input  type="checkbox" id="IU7" value="enlace_checkbox" ></div></td>
                </tr>


                <tr>
                    <td ><center><button type="button" class="btn btn-default"  onclick ="MIU_11()">Guardar</button></center>
					</td>
                    <td ><center><button type="button" class="btn btn-default" onclick="MIU_05()">Cancelar</button></td></center>
                </tr>
					</center>		
				</tbody>
			 
			</table>  
		</form>  
		<label  id="mensaje" class="text-danger">
			   </div>
		
		
		<!--div class="col-md-6"  ></label></div-->
			<div class="col-md-3"></div>
			<div class="col-md-3"> 		
					<center><div class="date panel-danger" style="background-color:#60161E; color:white; margin-top:240px" ></center><!-- div calendario-->
			 
					<script src="\..\javascripts/bootstrap-datepicker.js"></script> <!---Si se borra el pierde trate de acomodarlo 
		        en donde estan los otros js pero dice que no se encuentran, como que este y el bootstrap-datepicker.min.js chocan-->	
				</div>
			  
		     </div>
		

	    
<script type="text/javascript">
  
  $(document).ready(function () { //Metodo del calendario

  		$("#menuDiv").load("/menu.html");
                
                $('.date').datepicker({         
            });
     });
 
						
 function MIU_08(){//Realiza la consulta si un usuario existe
 
	let d = $('#IU4').val().toUpperCase();
	 fetch( 'http://localhost:3000/api/TP/B', {  
    method: 'POST', 
    datatype:'json',
    headers: {  
      "Content-type": "application/x-www-form-urlencoded"  
      } ,
    body: "TP_4="+ d
      }
	)	 .then(res => res.json())
     	
		.then(obj =>{
		if(obj.data[0]==null){
		setTimeout('MIU_05()', 1500);
		MIU_01();
		}
		else	
		$("#mensaje").text("Fallo al realizar la acción,\n el usuario a ingresar ya existe"); 
		
		}) 
	//	.then( _ => setTimeout('MIU_05()', 2000))
		.catch(err => console.log('Request failed', err));
		
	

 }
		

	function MIU_11(){//Realiza la función del boton de guardar llamando a los metodos correspondientes
	 if(MIU_02())
	MIU_08();	
	
	
	}
	
function MIU_01($scope){ //Recoge los datos de los campos y realiza el fecth de inserción 
							//a la base de datos
							
	let e3 = $('#IU1').val().toUpperCase();
	let f3 = $('#IU2').val().toUpperCase();
	let g3 = $('#IU3').val().toUpperCase();
	let h3 = $('#IU4').val().toUpperCase();
	let o3 = $('#IU5').val().toUpperCase();
	//let i3 = $('#IU6').val().toUpperCase();
	let j3;
	if($("#IU7").prop("checked"))
	 j3 = '1'; 
	else
	j3='0';
	MIU_09(e3,f3,g3,h3);
	MIU_10(h3,o3,j3);
	$("#mensaje").text("Acción realiza con exito");
 
}


function MIU_09(a,b,c,d){// Realiza la inserción de una persona a la base de datos

 fetch( 'http://localhost:3000/api/TP/I', {  
    method: 'POST', 
    datatype:'json',
    headers: {  
      "Content-type": "application/x-www-form-urlencoded"  
      } ,
    body: "TP_1="+ a + "&TP_2="+ b +"&TP_3="+ c +"&TP_4="+ d
      }
	  )
  .then(function(response) {
  return response.text().then(function(res) {
    console.log("Resultado: "+res);
    
  });
})
  .catch(function(error) {  
   console.log('Request failed', error);  
  });

	}
	
	function MIU_10(a2,b2,c2){//Realiza la inserciónde un usario a la base de datos

	fetch( 'http://localhost:3000/api/TU/I', {  
    method: 'POST', 
    datatype:'json',
    headers: {  
      "Content-type": "application/x-www-form-urlencoded"  
      } ,
    body: "TU_1="+ a2 + "&TU_2="+ b2 +"&TU_3="+ c2
      }
	  )
  .then(function(response) {
  return response.text().then(function(res) {
    console.log("Resultado: "+res);
    
  });
})
  .catch(function(error) {  
   console.log('Request failed', error);  
  });

	}

   
<!--valida todos los campos--->
function MIU_02(){	 //Valida los campos 
	I1 = true;
	I2 = true;
	I3 = true;
	I4 = true;
	I5 = true;
	I6= true;
	I7= true;

	if($("#IU1").val().length == 0 ){
		$("#div1").attr('class','form-group has-error') ;
		$("#IU1").attr('title','Campo Obligatorio') ;
		
		I1 = false;
	}
	else{
	$("#div1").attr('class','form-group') ;
	$("#IU1").attr('title','');
	}
		
	if($("#IU2").val().length == 0){
		$("#div2").attr('class','form-group has-error') ;
		$("#IU2").attr('title','Campo Obligatorio') ;
		I2 = false;
	}
	else{
	$("#div2").attr('class','form-group') ;
	$("#IU2").attr('title','');
	}
	if($("#IU3").val().length == 0){
		$("#div3").attr('class','form-group has-error') ;
		$("#IU3").attr('title','Campo Obligatorio') ;
		I3 = false;
	}
	else{
	$("#div3").attr('class','form-group') ;
	$("#IU3").attr('title','');
	}
	if($("#IU4").val().length == 0){
		$("#div4").attr('class','form-group has-error') ;
		$("#IU4").attr('title','Campo Obligatorio') ;
		I4 = false;
	}
	else{
	$("#div4").attr('class','form-group') ;
	$("#IU4").attr('title','');
	}
	
	if(isNaN($("#IU4").val())){
		$("#div4").attr('class','form-group has-error') ;
		$("#IU4").attr('title','Formato incorrecto') ;
		
		I7 = false;
	}
	else{
	$("#div4").attr('class','form-group') ;
	$("#IU4").attr('title','');
	}
	if($("#IU5").val().length == 0){
		$("#div5").attr('class','form-group has-error') ;
		$("#IU5").attr('title','Campo Obligatorio') ;
		I5 = false;
	}
	else{
	$("#div5").attr('class','form-group') ;
	$("#IU5").attr('title','');
	}
	
	if($("#IU6").val().length == 0){
		$("#div6").attr('class','form-group has-error') ;
		$("#IU6").attr('title','Campo Obligatorio') ;
		I6 = false;
	}
	else{
	$("#div6").attr('class','form-group') ;
	$("#IU6").attr('title','');
	}
	if($("#IU6").val()!=$("#IU5").val()){
	$("#div6").attr('class','form-group has-error') ;
		$("#IU6").attr('title','La contraseña no coincide') ;
		$("#div5").attr('class','form-group has-error') ;
		$("#IU5").attr('title','La contraseña no coincide') ;
		$("#IU5").val("");
	$("#IU6").val("");
		I6 = false;
	}
	else{
	if(I6&&I5){
	$("#div6").attr('class','form-group') ;
	$("#IU6").attr('title','');
	$("#div5").attr('class','form-group') ;
	$("#IU5").attr('title','');
	}
	
		return (I1 && I2  && I3  && I4 && I5 && I6 &&I7);	
}}

function MIU_03(){//Limpia el valor de los campos de entrada
for(let i=1;i<7;i++){
	MIU_04(i);
}
	$("#IU1").val("");
	$("#IU2").val("");
	$("#IU3").val("");
	$("#IU4").val("");
	$("#IU5").val("");
	$("#IU6").val("");
}

function MIU_04(op){//Realiza un cambio de clase a los campos de entrada del formulario de la clase has-error a from-group
	switch(op){
	case 1: document.getElementById("div1").className ="form-group" ; break;
	case 2: document.getElementById("div2").className ="form-group" ; break;
	case 3: document.getElementById("div3").className ="form-group" ; break;
	case 4: document.getElementById("div4").className ="form-group" ;break;
	case 5: document.getElementById("div5").className ="form-group" ;break;
	case 6: document.getElementById("div6").className ="form-group" ;break;
	
	default: break;
	}
}	
	
function MIU_05(){//Metodo del boton cancelar 
MIU_03();
MIU_06();
}

function MIU_06(){//Limpia el div con el id=mensaje 
$("#mensaje").text("");
}
 
function MIU_07(n){//Limpia los campos cuando se enfocan 
  MIU_06();
  MIU_04(n);
 }
 	  
  
</script>
    </body>
</html>